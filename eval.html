<!DOCTYPE html>
<html lang="fr-ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation Express | VendreTonAutoRapide.ca</title>
    <style>
        :root {
            --primary: #0056B3; /* Bleu Québec */
            --secondary: #E31937; /* Rouge Alerte */
            --accent: #FFC72C; /* Or */
            --dark: #1A1A1A;
            --light: #F8F9FA;
            --gray: #6C757D;
            --light-gray: #E9ECEF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', Arial, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }

        /* Header */
        .eval-header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
        }

        .logo span {
            color: var(--secondary);
        }

        /* Hero Évaluation */
        .eval-hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('1.png'); /* Placeholder image */
            background-size: cover;
            background-position: center;
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .eval-hero h1 {
            font-size: 42px;
            margin-bottom: 20px;
        }

        .eval-hero p {
            font-size: 20px;
            max-width: 700px;
            margin: 0 auto 30px;
        }

        /* Process Bar */
        .process-steps {
            display: flex;
            justify-content: space-between;
            max-width: 800px;
            margin: 40px auto;
            position: relative;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .process-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--gray);
            z-index: 1;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
            min-width: 100px;
            padding: 0 5px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }

        .step.active .step-number {
            background-color: var(--secondary);
        }

        .step-text {
            font-size: 14px;
            font-weight: 600;
        }

        /* Formulaire */
        .eval-form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 900px;
            margin: -50px auto 50px;
            position: relative;
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .form-header h2 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .form-header p {
            color: var(--gray);
            font-size: 16px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background-color: #C0112B;
            transform: translateY(-2px);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Section Photo Professionnelle */
        .photo-upload-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 30px;
        }

        .photo-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .photo-tab {
            padding: 12px 15px;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            border-bottom: 3px solid transparent;
            font-size: 15px;
            white-space: nowrap;
        }

        .photo-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
        }

        .photo-tab i {
            font-size: 15px;
        }

        .photo-tab-content {
            display: none;
        }

        .photo-tab-content.active {
            display: block;
        }

        .photo-guide {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .photo-guide h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .photo-guide h4 i {
            font-size: 20px;
        }

        .photo-examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-example-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .photo-example-card:hover {
            transform: translateY(-5px);
        }

        .photo-thumbnail {
            height: 100px;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .photo-thumbnail i {
            font-size: 40px;
            color: #555;
        }

        .photo-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: var(--secondary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .photo-details {
            padding: 12px;
        }

        .photo-details h5 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .photo-details p {
            color: var(--gray);
            font-size: 12px;
        }

        .upload-box {
            margin-top: 20px;
        }

        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
        }

        .upload-label:hover {
            border-color: var(--primary);
            background-color: rgba(0, 86, 179, 0.05);
        }

        .upload-label i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .upload-label span {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .upload-label small {
            color: var(--gray);
            font-size: 12px;
        }

        .radio-label {
            display: inline-block;
            margin-left: 8px;
            font-weight: normal;
            color: var(--dark);
        }
        .form-group .radio-label {
            display: block;
            margin-bottom: 10px;
            margin-left: 0;
        }
        .form-group input[type="radio"] {
            margin-right: 10px;
        }

        /* Image Preview Container */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            border: 1px dashed var(--light-gray);
            padding: 10px;
            min-height: 50px;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 14px;
        }
        .image-preview-container:empty::before {
            content: "Aucune image sélectionnée.";
            display: block;
            color: var(--gray);
        }

        .image-preview-item {
            position: relative;
            max-width: 120px;
            max-height: 100px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s ease-in-out;
            z-index: 10;
        }

        .delete-image-btn:hover {
            opacity: 1;
            background-color: #C0112B;
        }

        #vin-decoder-results {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: var(--light-gray);
            display: none;
        }

        #vin-decoder-results p {
            margin-bottom: 5px;
            color: var(--dark);
        }

        #vin-decoder-results strong {
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .eval-hero h1 {
                font-size: 32px;
            }

            .eval-hero p {
                font-size: 18px;
            }

            .eval-form-container {
                padding: 25px;
            }

            .photo-examples-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .photo-tab {
                padding: 8px 12px;
                font-size: 14px;
                gap: 5px;
            }

            .process-steps {
                flex-direction: column;
                align-items: center;
                margin-bottom: 20px;
            }
            .process-steps::before {
                display: none;
            }
            .step {
                flex: 0 0 100%;
                margin-bottom: 20px;
                padding: 0;
            }
            .step:last-child {
                margin-bottom: 0;
            }
        }

        @media (max-width: 480px) {
            .eval-hero h1 {
                font-size: 28px;
            }
            .eval-hero p {
                font-size: 16px;
            }
            .eval-form-container {
                padding: 15px;
            }
            .form-header h2 {
                font-size: 24px;
            }
            .form-control, .btn {
                font-size: 14px;
                padding: 10px 12px;
            }
            .photo-tab {
                font-size: 12px;
                padding: 6px 8px;
            }
            .photo-examples-grid {
                grid-template-columns: 1fr;
            }
            .radio-label {
                font-size: 14px;
            }
            .form-group .radio-label {
                padding-right: 5px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header class="eval-header">
        <div class="container">
            <div class="logo">VendreTonAuto<span>Rapide</span>.ca</div>
        </div>
    </header>

    <section class="eval-hero">
        <div class="container">
            <h1>Obtenez une offre ferme pour votre véhicule</h1>
            <p>Remplissez ce formulaire pour recevoir une évaluation gratuite et sans engagement en moins de 24 heures</p>

            <div class="process-steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-text">Info. du véhicule</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text">Coordonnées</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text">Confirmation</div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="eval-form-container">
            <div class="form-header">
                <h2>Informations sur votre véhicule</h2>
                <p>Tous les champs sont obligatoires pour une évaluation précise</p>
            </div>

            <form id="evaluationForm">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="vin">Numéro d'identification du véhicule (VIN) <i class="fas fa-question-circle" title="Le VIN se trouve généralement sur le tableau de bord (côté conducteur) ou sur l'étiquette de la porte."></i></label>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="text" id="vin" class="form-control" placeholder="Entrez le VIN de 17 caractères" maxlength="17" pattern="[A-HJ-NPR-Z0-9]{17}" title="Le VIN doit contenir 17 caractères alphanumériques (sans I, O, Q)" required style="flex: 1;">
                            <button type="button" id="scanVinBtn" class="btn" title="Scanner avec la caméra"
                                    onclick="window.location.href='scanner.html?returnUrl=' + encodeURIComponent(window.location.href);">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <button type="button" id="decodeVinBtn" class="btn" style="margin-top: 10px;">Décoder le VIN</button>
                    </div>

                    <div id="vin-decoder-results" class="full-width">
                        <h4>Résultats du décodage VIN :</h4>
                        <p>Marque: <strong id="decodedMarque">N/A</strong></p>
                        <p>Modèle: <strong id="decodedModele">N/A</strong></p>
                        <p>Année: <strong id="decodedAnnee">N/A</strong></p>
                        <p>Carburant: <strong id="decodedCarburant">N/A</strong></p>
                        <p>Transmission: <strong id="decodedTransmission">N/A</strong></p>
                        <p style="color: var(--gray); font-size: 13px; margin-top: 10px;">Veuillez vérifier et compléter les champs du formulaire avec les informations décodées. Si les champs ne sont pas remplis, le VIN n'a pas pu être décodé ou n'est pas supporté par l'API.</p>
                    </div>

                    <div class="form-group">
                        <label for="marque">Marque</label>
                        <select id="marque" class="form-control" required>
                            <option value="">Sélectionnez une marque</option>
                            <option>Acura</option>
                            <option>Audi</option>
                            <option>BMW</option>
                            <option>Chevrolet</option>
                            <option>Ford</option>
                            <option>Honda</option>
                            <option>Hyundai</option>
                            <option>Jeep</option>
                            <option>Kia</option>
                            <option>Lexus</option>
                            <option>Mazda</option>
                            <option>Mercedes-Benz</option>
                            <option>Nissan</option>
                            <option>Subaru</option>
                            <option>Toyota</option>
                            <option>Volkswagen</option>
                            <option>Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="modele">Modèle</label>
                        <input type="text" id="modele" class="form-control" placeholder="Ex: Civic, F-150, Rogue" required>
                    </div>

                    <div class="form-group">
                        <label for="annee">Année</label>
                        <select id="annee" class="form-control" required>
                            <option value="">Sélectionnez l'année</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kilometrage">Kilométrage</label>
                        <input type="number" id="kilometrage" class="form-control" placeholder="Ex: 75000" required>
                    </div>

                    <div class="form-group">
                        <label for="transmission">Transmission</label>
                        <select id="transmission" class="form-control" required>
                            <option value="">Sélectionnez</option>
                            <option>Automatique</option>
                            <option>Manuelle</option>
                            <option>Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="carburant">Type de carburant</label>
                        <select id="carburant" class="form-control" required>
                            <option value="">Sélectionnez</option>
                            <option>Essence</option>
                            <option>Diesel</option>
                            <option>Hybride</option>
                            <option>Électrique</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label>État général du véhicule <span style="color: var(--secondary); font-weight: normal;">(Choisissez l'option qui décrit le mieux l'état actuel)</span></label>
                        <div style="padding-left: 15px;">
                            <div class="form-group">
                                <input type="radio" id="etatExcellent" name="etat" value="Excellent" required>
                                <label for="etatExcellent" class="radio-label"><b>Excellent</b> - Véhicule en condition impeccable, sans aucun défaut esthétique ou mécanique notable. L'entretien a toujours été rigoureux et à jour.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatTresBon" name="etat" value="Très bon">
                                <label for="etatTresBon" class="radio-label"><b>Très bon</b> - Véhicule en très bonne condition générale. Quelques imperfections esthétiques mineures (ex: petites égratignures) peuvent être présentes, mais aucun problème mécanique significatif.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatBon" name="etat" value="Bon">
                                <label for="etatBon" class="radio-label"><b>Bon</b> - Véhicule en condition correcte avec une usure normale pour son âge et son kilométrage. Quelques réparations mineures pourraient être à prévoir à court ou moyen terme. L'esthétique présente des signes d'utilisation.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatAcceptable" name="etat" value="Acceptable">
                                <label for="etatAcceptable" class="radio-label"><b>Acceptable</b> - Véhicule avec une usure plus prononcée et potentiellement des réparations nécessaires. Des problèmes esthétiques et/ou mécaniques sont présents, mais le véhicule est toujours fonctionnel (sauf indication contraire).</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatNonFonctionnel" name="etat" value="Non fonctionnel">
                                <label for="etatNonFonctionnel" class="radio-label"><b>Non fonctionnel</b> - Véhicule qui ne démarre pas ou qui présente des problèmes mécaniques majeurs le rendant inutilisable en l'état actuel.</label>
                            </div>
                        </div>
                    </div>

                    <div class="full-width photo-upload-section">
                        <h3>Photos de votre véhicule</h3>
                        <p>Veuillez téléverser des photos claires pour une évaluation plus précise.</p>

                        <div class="photo-tabs">
                            <button class="photo-tab active" data-tab="exterieur"><i class="fas fa-car"></i> Extérieur</button>
                            <button class="photo-tab" data-tab="interieur"><i class="fas fa-tachometer-alt"></i> Intérieur</button>
                            <button class="photo-tab" data-tab="dommages"><i class="fas fa-exclamation-triangle"></i> Dommages</button>
                        </div>

                        <div id="exterieur" class="photo-tab-content active">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Guide pour les photos de l'extérieur</h4>
                                <p>Veuillez prendre des photos claires de tous les angles de votre véhicule.</p>
                                <div class="photo-examples-grid">
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Avant 3/4');"></div>
                                        <div class="photo-details">
                                            <h5>Avant 3/4</h5>
                                            <p>Montrant l'avant et le côté.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Arrière 3/4');"></div>
                                        <div class="photo-details">
                                            <h5>Arrière 3/4</h5>
                                            <p>Montrant l'arrière et le côté.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Côté Droit');"></div>
                                        <div class="photo-details">
                                            <h5>Côté (Droit)</h5>
                                            <p>Vue latérale complète.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Côté Gauche');"></div>
                                        <div class="photo-details">
                                            <h5>Côté (Gauche)</h5>
                                            <p>Autre vue latérale complète.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="upload-box">
                                <label for="photoExterieur" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos de l'extérieur ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoExterieur" class="photo-input" data-category="Exterieur" data-max-files="10" multiple style="display: none;">
                                <div id="exterieur-preview" class="image-preview-container"></div>
                            </div>
                        </div>

                        <div id="interieur" class="photo-tab-content">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Guide pour les photos de l'intérieur</h4>
                                <p>Veuillez prendre des photos claires du tableau de bord, des sièges avant et arrière.</p>
                                <div class="photo-examples-grid">
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Tableau de bord');"></div>
                                        <div class="photo-details">
                                            <h5>Tableau de bord</h5>
                                            <p>Vue complète du tableau de bord.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Sièges Avant');"></div>
                                        <div class="photo-details">
                                            <h5>Sièges Avant</h5>
                                            <p>Les deux sièges avant en entier.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Sièges Arrière');"></div>
                                        <div class="photo-details">
                                            <h5>Sièges Arrière</h5>
                                            <p>La banquette arrière en entier.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Odomètre');"></div>
                                        <div class="photo-details">
                                            <h5>Odomètre</h5>
                                            <p>Lecture claire du kilométrage.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="upload-box">
                                <label for="photoInterieur" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos de l'intérieur ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoInterieur" class="photo-input" data-category="Interieur" data-max-files="10" multiple style="display: none;">
                                <div id="interieur-preview" class="image-preview-container"></div>
                            </div>
                        </div>

                        <div id="dommages" class="photo-tab-content">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Photos des dommages </h4>
                                <p>Veuillez prendre des photos claires de tous les dommages ou imperfections notables.</p>
                            </div>
                            <div class="upload-box">
                                <label for="photoDommages" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos des dommages ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoDommages" class="photo-input" data-category="Dommages" data-max-files="20" multiple style="display: none;">
                                <div id="dommages-preview" class="image-preview-container"></div>
                            </div>
                        </div>
                    </div>

                    <div class="full-width" style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 30px;">
                        <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">Vos Coordonnées</h3>
                        <p style="text-align: center; color: var(--gray); margin-bottom: 30px;">Veuillez nous fournir vos informations de contact pour recevoir l'évaluation.</p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nom">Nom Complet</label>
                                <input type="text" id="nom" class="form-control" placeholder="Votre nom" required>
                            </div>
                            <div class="form-group">
                                <label for="courriel">Courriel</label>
                                <input type="email" id="courriel" class="form-control" placeholder="votre.courriel@exemple.com" required>
                            </div>
                            <div class="form-group">
                                <label for="telephone">Numéro de Téléphone</label>
                                <input type="tel" id="telephone" class="form-control" placeholder="123-456-7890" required>
                            </div>
                            <div class="form-group">
                                <label for="ville">Ville</label>
                                <input type="text" id="ville" class="form-control" placeholder="Ex: Repentigny" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width" style="margin-top: 30px;">
                        <button type="submit" class="btn btn-block">Soumettre et Obtenir l'Évaluation</button>
                        <button type="button" id="generatePdfBtn" class="btn btn-block" style="background-color: var(--primary); margin-top: 15px;">Générer le PDF de l'Évaluation</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Tab functionality for photo upload
        document.querySelectorAll('.photo-tab').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.photo-tab').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.photo-tab-content').forEach(content => content.classList.remove('active'));

                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });

        // Dynamic Year for 'annee' select
        const anneeSelect = document.getElementById('annee');
        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= 1990; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            anneeSelect.appendChild(option);
        }

        // --- DÉCODEUR VIN RÉEL (API NHTSA - CÔTÉ CLIENT) ---
        // ATTENTION : Cette API est principalement pour les véhicules nord-américains et est limitée.
        // Pour une solution complète et fiable, un backend est recommandé.
        document.getElementById('decodeVinBtn').addEventListener('click', async () => {
            const vinInput = document.getElementById('vin').value.trim(); // Trim pour enlever les espaces
            const vinResultsDiv = document.getElementById('vin-decoder-results');
            vinResultsDiv.style.display = 'none'; // Cacher les résultats précédents

            // Réinitialiser les champs affichés
            document.getElementById('decodedMarque').textContent = 'N/A';
            document.getElementById('decodedModele').textContent = 'N/A';
            // CORRECTION ICI: document.getElementById au lieu de document()
            document.getElementById('decodedAnnee').textContent = 'N/A';
            document.getElementById('decodedCarburant').textContent = 'N/A';
            document.getElementById('decodedTransmission').textContent = 'N/A';

            // Réinitialiser les champs du formulaire pré-remplis
            document.getElementById('marque').value = '';
            document.getElementById('modele').value = '';
            document.getElementById('annee').value = '';
            document.getElementById('carburant').value = '';
            document.getElementById('transmission').value = '';


            if (vinInput.length === 17) {
                try {
                    const apiUrl = `https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVinValues/${vinInput}?format=json`;
                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    if (data && data.Results && data.Results.length > 0) {
                        const decodedVehicle = data.Results[0]; // Prend le premier résultat

                        // Fonction utilitaire pour obtenir une valeur et retourner 'N/A' si vide/null
                        const getValue = (val) => (val && val !== "null" && val !== "") ? val : 'N/A';

                        // Normalisation et affichage de la Marque
                        let marque = getValue(decodedVehicle.Make);
                        if (marque !== 'N/A') {
                            marque = marque.charAt(0).toUpperCase() + marque.slice(1).toLowerCase();
                        }
                        document.getElementById('decodedMarque').textContent = marque;

                        // Normalisation et affichage du Modèle (juste la première lettre en majuscule)
                        let modele = getValue(decodedVehicle.Model);
                        if (modele !== 'N/A') {
                            modele = modele.charAt(0).toUpperCase() + modele.slice(1).toLowerCase();
                        }
                        document.getElementById('decodedModele').textContent = modele;

                        // Affichage de l'Année
                        const annee = getValue(decodedVehicle.ModelYear);
                        document.getElementById('decodedAnnee').textContent = annee;

                        // Normalisation et affichage du Carburant
                        let carburant = getValue(decodedVehicle.FuelTypePrimary || decodedVehicle.FuelType);
                        const carburantMap = {
                            "GASOLINE": "Essence",
                            "DIESEL": "Diesel",
                            "ELECTRIC": "Électrique",
                            "HYBRID": "Hybride",
                            "FLEXIBLE": "Essence/Éthanol",
                            "ETHANOL": "Éthanol",
                            "CNG": "GNV", // Gaz Naturel Véhicule
                            "LPG": "GPL"  // Gaz de Pétrole Liquéfié
                        };
                        carburant = carburantMap[carburant.toUpperCase()] || carburant; // Traduit ou garde l'original si non trouvé
                        document.getElementById('decodedCarburant').textContent = carburant;

                        // Normalisation et affichage de la Transmission
                        let transmission = getValue(decodedVehicle.TransmissionStyle || decodedVehicle.Transmission);
                        const transmissionMap = {
                            "AUTOMATIC": "Automatique",
                            "MANUAL": "Manuelle",
                            "SEMI-AUTOMATIC": "Semi-automatique",
                            "CVT": "CVT",
                            "AUTOMATED MANUAL": "Manuelle Automatisée"
                        };
                        transmission = transmissionMap[transmission.toUpperCase()] || transmission; // Traduit ou garde l'original si non trouvé
                        document.getElementById('decodedTransmission').textContent = transmission;

                        // Pré-remplir les champs du formulaire si les données sont valides et non vides
                        if (marque !== 'N/A') {
                            // Vérifier si l'option de la marque existe, sinon l'ajouter pour la pré-sélection
                            let optionExists = Array.from(document.getElementById('marque').options).some(opt => opt.value.toLowerCase() === marque.toLowerCase());
                            if (!optionExists && marque !== 'N/A') {
                                let newOption = new Option(marque, marque);
                                document.getElementById('marque').add(newOption);
                            }
                            document.getElementById('marque').value = marque;
                        }
                        if (modele !== 'N/A') document.getElementById('modele').value = modele;
                        if (annee !== 'N/A') document.getElementById('annee').value = annee;
                        
                        if (carburant !== 'N/A') {
                            // Vérifier si l'option existe déjà dans le select, sinon l'ajouter (pour les cas non standards)
                            let optionExists = Array.from(document.getElementById('carburant').options).some(opt => opt.value.toLowerCase() === carburant.toLowerCase());
                            if (!optionExists && carburant !== 'N/A') {
                                let newOption = new Option(carburant, carburant);
                                document.getElementById('carburant').add(newOption);
                            }
                            document.getElementById('carburant').value = carburant;
                        }

                        if (transmission !== 'N/A') {
                             // Vérifier si l'option existe déjà dans le select, sinon l'ajouter
                            let optionExists = Array.from(document.getElementById('transmission').options).some(opt => opt.value.toLowerCase() === transmission.toLowerCase());
                            if (!optionExists && transmission !== 'N/A') {
                                let newOption = new Option(transmission, transmission);
                                document.getElementById('transmission').add(newOption);
                            }
                            document.getElementById('transmission').value = transmission;
                        }
                        
                        vinResultsDiv.style.display = 'block'; // Afficher les résultats
                    } else {
                        alert('Aucune information trouvée pour ce VIN. Il est peut-être non valide ou non supporté par cette API.');
                    }
                } catch (error) {
                    console.error('Erreur lors du décodage du VIN:', error);
                    alert('Une erreur est survenue lors du décodage du VIN. Veuillez vérifier votre connexion ou réessayer plus tard.');
                }
            } else {
                alert('Veuillez entrer un VIN valide (17 caractères).');
            }
        });


        // --- GESTION DES FICHIERS POUR LES PHOTOS ---
        // Objet pour stocker les fichiers de chaque catégorie
        const allUploadedFiles = {
            Exterieur: [],
            Interieur: [],
            Dommages: []
        };

        document.querySelectorAll('.photo-input').forEach(input => {
            const category = input.dataset.category;
            const maxFiles = parseInt(input.dataset.maxFiles || '10');
            const previewContainer = document.getElementById(category.toLowerCase() + '-preview');

            input.addEventListener('change', (event) => {
                const newFiles = Array.from(event.target.files);

                // Filtrer les fichiers non-image et vérifier la limite
                const validNewFiles = newFiles.filter(file => file.type.startsWith('image/'));

                // Ajouter les nouveaux fichiers valides au tableau existant
                // Utiliser un Set pour éviter les doublons si l'utilisateur sélectionne plusieurs fois le même fichier
                allUploadedFiles[category] = [...new Set([...allUploadedFiles[category], ...validNewFiles])];

                // Tronquer si la limite est dépassée
                if (allUploadedFiles[category].length > maxFiles) {
                    alert(`Vous ne pouvez ajouter qu'un maximum de ${maxFiles} photos pour la catégorie "${category}". Les premières photos seront conservées.`);
                    allUploadedFiles[category] = allUploadedFiles[category].slice(0, maxFiles);
                }

                renderPreviews(category, previewContainer);
            });

            // Gérer le glisser-déposer (Drag and Drop)
            const uploadLabel = input.previousElementSibling; // Le label est l'élément précédent l'input masqué
            if (uploadLabel && uploadLabel.classList.contains('upload-label')) {
                uploadLabel.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Empêche l'ouverture du fichier dans le navigateur
                    uploadLabel.style.borderColor = 'var(--secondary)'; // Effet visuel
                });

                uploadLabel.addEventListener('dragleave', (e) => {
                    uploadLabel.style.borderColor = '#ccc'; // Revertir l'effet visuel
                });

                uploadLabel.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadLabel.style.borderColor = '#ccc'; // Revertir l'effet visuel
                    const droppedFiles = Array.from(e.dataTransfer.files);
                    // Simuler l'ajout via l'input en créant un DataTransfer
                    const dataTransfer = new DataTransfer();
                    droppedFiles.forEach(file => dataTransfer.items.add(file));
                    input.files = dataTransfer.files; // Attribue les fichiers glissés à l'input
                    input.dispatchEvent(new Event('change')); // Déclenche l'événement change manuellement
                });
            }
        });

        function renderPreviews(category, previewContainer) {
            previewContainer.innerHTML = ''; // Efface tous les aperçus actuels
            
            if (allUploadedFiles[category].length === 0) {
                previewContainer.innerHTML = 'Aucune image sélectionnée.';
                return;
            }

            allUploadedFiles[category].forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imgDiv = document.createElement('div');
                    imgDiv.className = 'image-preview-item';
                    imgDiv.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="delete-image-btn" data-index="${index}" data-category="${category}">&times;</button>
                    `;
                    previewContainer.appendChild(imgDiv);

                    // Écouteur pour le bouton de suppression
                    imgDiv.querySelector('.delete-image-btn').addEventListener('click', (event) => {
                        const fileIndex = parseInt(event.target.dataset.index);
                        const fileCategory = event.target.dataset.category;

                        // Supprime le fichier du tableau
                        allUploadedFiles[fileCategory].splice(fileIndex, 1);
                        
                        // Ré-affiche les aperçus pour mettre à jour les index et les visuels
                        renderPreviews(fileCategory, document.getElementById(fileCategory.toLowerCase() + '-preview'));
                    });
                };
                reader.readAsDataURL(file); // Lit le fichier comme une URL de données pour l'aperçu
            });
        }

        // PDF Generation Logic (using jspdf)
        document.getElementById('generatePdfBtn').addEventListener('click', async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Collect form data
            const vin = document.getElementById('vin').value || 'N/A';
            const marque = document.getElementById('marque').value || 'N/A';
            const modele = document.getElementById('modele').value || 'N/A';
            const annee = document.getElementById('annee').value || 'N/A';
            const kilometrage = document.getElementById('kilometrage').value || 'N/A';
            const transmission = document.getElementById('transmission').value || 'N/A';
            const carburant = document.getElementById('carburant').value || 'N/A';
            const etatRadio = document.querySelector('input[name="etat"]:checked');
            const etat = etatRadio ? etatRadio.value : 'N/A';

            // Contact Info
            const nom = document.getElementById('nom').value || 'N/A';
            const courriel = document.getElementById('courriel').value || 'N/A';
            const telephone = document.getElementById('telephone').value || 'N/A';
            const ville = document.getElementById('ville').value || 'N/A'; 

            let yPos = 10; // Y position for text
            const margin = 10;
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const imgWidth = 80; // Largeur des images dans le PDF
            const imgHeight = 60; // Hauteur des images dans le PDF
            const imgMargin = 5; // Marge entre les images

            doc.setFontSize(18);
            doc.text("Rapport d'Évaluation Véhicule", margin, yPos);
            yPos += 10;
            doc.setFontSize(12);
            doc.text("Généré le: " + new Date().toLocaleDateString('fr-CA', { year: 'numeric', month: 'long', day: 'numeric' }) + " à " + new Date().toLocaleTimeString('fr-CA'), margin, yPos);
            yPos += 20;

            doc.setFontSize(14);
            doc.text("Informations du Véhicule:", margin, yPos);
            yPos += 7;
            doc.setFontSize(12);
            doc.text(`VIN: ${vin}`, margin + 5, yPos); yPos += 7;
            doc.text(`Marque: ${marque}`, margin + 5, yPos); yPos += 7;
            doc.text(`Modèle: ${modele}`, margin + 5, yPos); yPos += 7;
            doc.text(`Année: ${annee}`, margin + 5, yPos); yPos += 7;
            doc.text(`Kilométrage: ${kilometrage} km`, margin + 5, yPos); yPos += 7;
            doc.text(`Transmission: ${transmission}`, margin + 5, yPos); yPos += 7;
            doc.text(`Carburant: ${carburant}`, margin + 5, yPos); yPos += 7;
            doc.text(`État Général: ${etat}`, margin + 5, yPos); yPos += 15;

            doc.setFontSize(14);
            doc.text("Coordonnées du Propriétaire:", margin, yPos);
            yPos += 7;
            doc.setFontSize(12);
            doc.text(`Nom: ${nom}`, margin + 5, yPos); yPos += 7;
            doc.text(`Courriel: ${courriel}`, margin + 5, yPos); yPos += 7;
            doc.text(`Téléphone: ${telephone}`, margin + 5, yPos); yPos += 7;
            doc.text(`Ville: ${ville}`, margin + 5, yPos); yPos += 15;

            doc.setFontSize(14);
            doc.text("Photos Téléversées:", margin, yPos);
            yPos += 7;
            doc.setFontSize(12);

            // Function to convert File to DataURL
            const fileToDataURL = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            };

            for (const category in allUploadedFiles) {
                if (allUploadedFiles[category].length > 0) {
                    doc.text(`- Catégorie: ${category}`, margin + 5, yPos);
                    yPos += 7;

                    let currentX = margin + 10;
                    for (const file of allUploadedFiles[category]) {
                        // Check if there's enough space for the image + next image
                        if (currentX + imgWidth + imgMargin > pageWidth - margin) {
                            currentX = margin + 10; // Reset X for new row
                            yPos += imgHeight + imgMargin; // Move down for new row
                        }

                        // Check for new page if not enough vertical space
                        if (yPos + imgHeight + margin > pageHeight) {
                            doc.addPage();
                            yPos = margin; // Reset Y for new page
                            currentX = margin + 10; // Reset X for new page
                            doc.setFontSize(14);
                            doc.text(`Photos Téléversées (suite):`, margin, yPos);
                            yPos += 7;
                            doc.setFontSize(12);
                            doc.text(`- Catégorie: ${category} (suite)`, margin + 5, yPos);
                            yPos += 7;
                        }

                        try {
                            const dataURL = await fileToDataURL(file);
                            doc.addImage(dataURL, file.type.split('/')[1].toUpperCase(), currentX, yPos, imgWidth, imgHeight);
                            currentX += imgWidth + imgMargin;
                        } catch (error) {
                            console.error(`Erreur lors de l'ajout de l'image ${file.name}:`, error);
                            doc.text(`[Image ${file.name} non chargée]`, currentX, yPos + imgHeight / 2); // Placeholder text
                            currentX += imgWidth + imgMargin;
                        }
                    }
                    yPos += imgHeight + imgMargin; // Move Y after last row of images for this category
                    if (yPos > pageHeight - margin) { // Check if new page needed after category
                        doc.addPage();
                        yPos = margin;
                    }
                }
            }

            doc.save('Evaluation_Vehicule.pdf');
        });

        // Form submission (placeholder)
        document.getElementById('evaluationForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Here you would collect all form data (including photos)
            // and send it to your server using Fetch API or XMLHttpRequest.
            //
            // POUR ENVOOYER LES PHOTOS AU SERVEUR :
            // Vous devrez créer un objet FormData et y ajouter les fichiers du tableau 'allUploadedFiles'.
            // const formData = new FormData(this); // Ceci prendra les autres champs du formulaire
            // for (const category in allUploadedFiles) {
            //     allUploadedFiles[category].forEach((file, index) => {
            //         formData.append(`${category}_photo_${index}`, file); // Nommez vos fichiers de manière unique
            //     });
            // }
            //
            // Exemple d'envoi (nécessite un backend pour recevoir ces données):
            // fetch('/submit-evaluation', {
            //     method: 'POST',
            //     body: formData
            // })
            // .then(response => response.json())
            // .then(data => {
            //     alert('Formulaire soumis avec succès!');
            //     console.log(data);
            //     // Handle success (e.g., redirect to a confirmation page)
            // })
            // .catch(error => {
            //     console.error('Erreur lors de la soumission:', error);
            //     alert('Une erreur est survenue lors de la soumission du formulaire.');
            // });

            alert('Formulaire soumis (logique de soumission réelle non implémentée). Le PDF a été généré.');

            // You might call the PDF generation here if it's part of the submission flow
            // document.getElementById('generatePdfBtn').click();
        });

    </script>
</body>
</html>
