<!DOCTYPE html>
<html lang="fr-ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation Express | VendreTonAutoRapide.ca</title>
    <style>
        :root {
            --primary: #0056B3; /* Bleu Québec */
            --secondary: #E31937; /* Rouge Alerte */
            --accent: #FFC72C; /* Or */
            --dark: #1A1A1A;
            --light: #F8F9FA;
            --gray: #6C757D;
            --light-gray: #E9ECEF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', Arial, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }

        /* Header */
        .eval-header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
        }

        .logo span {
            color: var(--secondary);
        }

        /* Hero Évaluation */
        .eval-hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('1.png'); /* Placeholder image */
            background-size: cover;
            background-position: center;
            color: white;
            padding: 80px 0;
            text-align: center;
        }

        .eval-hero h1 {
            font-size: 42px;
            margin-bottom: 20px;
        }

        .eval-hero p {
            font-size: 20px;
            max-width: 700px;
            margin: 0 auto 30px;
        }

        /* Process Bar */
        .process-steps {
            display: flex;
            justify-content: space-between;
            max-width: 800px;
            margin: 40px auto;
            position: relative;
            flex-wrap: wrap;
            padding: 0 10px;
        }

        .process-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--gray);
            z-index: 1;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
            min-width: 100px;
            padding: 0 5px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }

        .step.active .step-number {
            background-color: var(--secondary);
        }

        .step-text {
            font-size: 14px;
            font-weight: 600;
        }

        /* Formulaire */
        .eval-form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 900px;
            margin: -50px auto 50px;
            position: relative;
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .form-header h2 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .form-header p {
            color: var(--gray);
            font-size: 16px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background-color: #C0112B;
            transform: translateY(-2px);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Section Photo Professionnelle */
        .photo-upload-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 30px;
        }

        .photo-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .photo-tab {
            padding: 12px 15px;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            border-bottom: 3px solid transparent;
            font-size: 15px;
            white-space: nowrap;
        }

        .photo-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
        }

        .photo-tab i {
            font-size: 15px;
        }

        .photo-tab-content {
            display: none;
        }

        .photo-tab-content.active {
            display: block;
        }

        .photo-guide {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .photo-guide h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .photo-guide h4 i {
            font-size: 20px;
        }

        .photo-examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-example-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .photo-example-card:hover {
            transform: translateY(-5px);
        }

        .photo-thumbnail {
            height: 100px;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .photo-thumbnail i {
            font-size: 40px;
            color: #555;
        }

        .photo-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: var(--secondary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            z-index: 10;
        }

        .photo-details {
            padding: 12px;
        }

        .photo-details h5 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .photo-details p {
            color: var(--gray);
            font-size: 12px;
        }

        .upload-box {
            margin-top: 20px;
        }

        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
        }

        .upload-label:hover {
            border-color: var(--primary);
            background-color: rgba(0, 86, 179, 0.05);
        }

        .upload-label i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .upload-label span {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .upload-label small {
            color: var(--gray);
            font-size: 12px;
        }

        .radio-label {
            display: inline-block;
            margin-left: 8px;
            font-weight: normal;
            color: var(--dark);
        }
        .form-group .radio-label {
            display: block;
            margin-bottom: 10px;
            margin-left: 0;
        }
        .form-group input[type="radio"] {
            margin-right: 10px;
        }

        /* Image Preview Container */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            border: 1px dashed var(--light-gray);
            padding: 10px;
            min-height: 50px;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 14px;
        }
        .image-preview-container:empty::before {
            content: "Aucune image sélectionnée.";
            display: block;
            color: var(--gray);
        }

        .image-preview-item {
            position: relative;
            max-width: 120px;
            max-height: 100px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s ease-in-out;
            z-index: 10;
        }

        .delete-image-btn:hover {
            opacity: 1;
            background-color: #C0112B;
        }

        #vin-decoder-results {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: var(--light-gray);
            display: none;
        }

        #vin-decoder-results p {
            margin-bottom: 5px;
            color: var(--dark);
        }

        #vin-decoder-results strong {
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .eval-hero h1 {
                font-size: 32px;
            }

            .eval-hero p {
                font-size: 18px;
            }

            .eval-form-container {
                padding: 25px;
            }

            .photo-examples-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .photo-tab {
                padding: 8px 12px;
                font-size: 14px;
                gap: 5px;
            }

            .process-steps {
                flex-direction: column;
                align-items: center;
                margin-bottom: 20px;
            }
            .process-steps::before {
                display: none;
            }
            .step {
                flex: 0 0 100%;
                margin-bottom: 20px;
                padding: 0;
            }
            .step:last-child {
                margin-bottom: 0;
            }
        }

        @media (max-width: 480px) {
            .eval-hero h1 {
                font-size: 28px;
            }
            .eval-hero p {
                font-size: 16px;
            }
            .eval-form-container {
                padding: 15px;
            }
            .form-header h2 {
                font-size: 24px;
            }
            .form-control, .btn {
                font-size: 14px;
                padding: 10px 12px;
            }
            .photo-tab {
                font-size: 12px;
                padding: 6px 8px;
            }
            .photo-examples-grid {
                grid-template-columns: 1fr;
            }
            .radio-label {
                font-size: 14px;
            }
            .form-group .radio-label {
                padding-right: 5px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header class="eval-header">
        <div class="container">
            <div class="logo">VendreTonAuto<span>Rapide</span>.ca</div>
        </div>
    </header>

    <section class="eval-hero">
        <div class="container">
            <h1>Obtenez une offre ferme pour votre véhicule</h1>
            <p>Remplissez ce formulaire pour recevoir une évaluation gratuite et sans engagement en moins de 24 heures</p>

            <div class="process-steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-text">Info. du véhicule</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text">Coordonnées</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text">Confirmation</div>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="eval-form-container">
            <div class="form-header">
                <h2>Informations sur votre véhicule</h2>
                <p>Tous les champs sont obligatoires pour une évaluation précise</p>
            </div>

            <form id="evaluationForm">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="vin">Numéro d'identification du véhicule (VIN) <i class="fas fa-question-circle" title="Le VIN se trouve généralement sur le tableau de bord (côté conducteur) ou sur l'étiquette de la porte."></i></label>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="text" id="vin" class="form-control" placeholder="Entrez le VIN de 17 caractères" maxlength="17" pattern="[A-HJ-NPR-Z0-9]{17}" title="Le VIN doit contenir 17 caractères alphanumériques (sans I, O, Q)" required style="flex: 1;">
                            <button type="button" id="scanVinBtn" class="btn" title="Scanner avec la caméra"
                                onclick="window.location.href='scanner.html?returnUrl=' + encodeURIComponent(window.location.href);">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <button type="button" id="decodeVinBtn" class="btn" style="margin-top: 10px;">Décoder le VIN</button>
                    </div>

                    <div id="vin-decoder-results" class="full-width">
                        <h4>Résultats du décodage VIN :</h4>
                        <p>Marque: <strong id="decodedMarque">N/A</strong></p>
                        <p>Modèle: <strong id="decodedModele">N/A</strong></p>
                        <p>Année: <strong id="decodedAnnee">N/A</strong></p>
                        <p>Carburant: <strong id="decodedCarburant">N/A</strong></p>
                        <p>Transmission: <strong id="decodedTransmission">N/A</strong></p>
                        <p style="color: var(--gray); font-size: 13px; margin-top: 10px;">Veuillez vérifier et compléter les champs du formulaire avec les informations décodées. Si les champs ne sont pas remplis, le VIN n'a pas pu être décodé ou n'est pas supporté par l'API.</p>
                    </div>

                    <div class="form-group">
                        <label for="marque">Marque</label>
                        <select id="marque" class="form-control" required>
                            <option value="">Sélectionnez une marque</option>
                            <option>Acura</option>
                            <option>Audi</option>
                            <option>BMW</option>
                            <option>Chevrolet</option>
                            <option>Ford</option>
                            <option>Honda</option>
                            <option>Hyundai</option>
                            <option>Jeep</option>
                            <option>Kia</option>
                            <option>Lexus</option>
                            <option>Mazda</option>
                            <option>Mercedes-Benz</option>
                            <option>Nissan</option>
                            <option>Subaru</option>
                            <option>Toyota</option>
                            <option>Volkswagen</option>
                            <option>Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="modele">Modèle</label>
                        <input type="text" id="modele" class="form-control" placeholder="Ex: Civic, F-150, Rogue" required>
                    </div>

                    <div class="form-group">
                        <label for="annee">Année</label>
                        <select id="annee" class="form-control" required>
                            <option value="">Sélectionnez l'année</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kilometrage">Kilométrage</label>
                        <input type="number" id="kilometrage" class="form-control" placeholder="Ex: 75000" required>
                    </div>

                    <div class="form-group">
                        <label for="transmission">Transmission</label>
                        <select id="transmission" class="form-control" required>
                            <option value="">Sélectionnez</option>
                            <option>Automatique</option>
                            <option>Manuelle</option>
                            <option>Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="carburant">Type de carburant</label>
                        <select id="carburant" class="form-control" required>
                            <option value="">Sélectionnez</option>
                            <option>Essence</option>
                            <option>Diesel</option>
                            <option>Hybride</option>
                            <option>Électrique</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label>État général du véhicule <span style="color: var(--secondary); font-weight: normal;">(Choisissez l'option qui décrit le mieux l'état actuel)</span></label>
                        <div style="padding-left: 15px;">
                            <div class="form-group">
                                <input type="radio" id="etatExcellent" name="etat" value="Excellent" required>
                                <label for="etatExcellent" class="radio-label"><b>Excellent</b> - Véhicule en condition impeccable, sans aucun défaut esthétique ou mécanique notable. L'entretien a toujours été rigoureux et à jour.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatTresBon" name="etat" value="Très bon">
                                <label for="etatTresBon" class="radio-label"><b>Très bon</b> - Véhicule en très bonne condition générale. Quelques imperfections esthétiques mineures (ex: petites égratignures) peuvent être présentes, mais aucun problème mécanique significatif.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatBon" name="etat" value="Bon">
                                <label for="etatBon" class="radio-label"><b>Bon</b> - Véhicule en condition correcte avec une usure normale pour son âge et son kilométrage. Quelques réparations mineures pourraient être à prévoir à court ou moyen terme. L'esthétique présente des signes d'utilisation.</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatAcceptable" name="etat" value="Acceptable">
                                <label for="etatAcceptable" class="radio-label"><b>Acceptable</b> - Véhicule avec une usure plus prononcée et potentiellement des réparations nécessaires. Des problèmes esthétiques et/ou mécaniques sont présents, mais le véhicule est toujours fonctionnel (sauf indication contraire).</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="etatNonFonctionnel" name="etat" value="Non fonctionnel">
                                <label for="etatNonFonctionnel" class="radio-label"><b>Non fonctionnel</b> - Véhicule qui ne démarre pas ou qui présente des problèmes mécaniques majeurs le rendant inutilisable en l'état actuel.</label>
                            </div>
                        </div>
                    </div>

                    <div class="full-width photo-upload-section">
                        <h3>Photos de votre véhicule</h3>
                        <p>Veuillez téléverser des photos claires pour une évaluation plus précise.</p>

                        <div class="photo-tabs">
                            <button class="photo-tab active" data-tab="exterieur"><i class="fas fa-car"></i> Extérieur</button>
                            <button class="photo-tab" data-tab="interieur"><i class="fas fa-tachometer-alt"></i> Intérieur</button>
                            <button class="photo-tab" data-tab="dommages"><i class="fas fa-exclamation-triangle"></i> Dommages</button>
                        </div>

                        <div id="exterieur" class="photo-tab-content active">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Guide pour les photos de l'extérieur</h4>
                                <p>Veuillez prendre des photos claires de tous les angles de votre véhicule.</p>
                                <div class="photo-examples-grid">
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Avant 3/4');"></div>
                                        <div class="photo-details">
                                            <h5>Avant 3/4</h5>
                                            <p>Montrant l'avant et le côté.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Arrière 3/4');"></div>
                                        <div class="photo-details">
                                            <h5>Arrière 3/4</h5>
                                            <p>Montrant l'arrière et le côté.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Côté Droit');"></div>
                                        <div class="photo-details">
                                            <h5>Côté (Droit)</h5>
                                            <p>Vue latérale complète.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Côté Gauche');"></div>
                                        <div class="photo-details">
                                            <h5>Côté (Gauche)</h5>
                                            <p>Autre vue latérale complète.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="upload-box">
                                <label for="photoExterieur" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos de l'extérieur ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoExterieur" class="photo-input" data-category="Exterieur" data-max-files="10" multiple style="display: none;">
                                <div id="exterieur-preview" class="image-preview-container"></div>
                            </div>
                        </div>

                        <div id="interieur" class="photo-tab-content">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Guide pour les photos de l'intérieur</h4>
                                <p>Veuillez prendre des photos claires du tableau de bord, des sièges avant et arrière.</p>
                                <div class="photo-examples-grid">
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Tableau de bord');"></div>
                                        <div class="photo-details">
                                            <h5>Tableau de bord</h5>
                                            <p>Vue complète du tableau de bord.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Sièges Avant');"></div>
                                        <div class="photo-details">
                                            <h5>Sièges Avant</h5>
                                            <p>Les deux sièges avant en entier.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Sièges Arrière');"></div>
                                        <div class="photo-details">
                                            <h5>Sièges Arrière</h5>
                                            <p>La banquette arrière en entier.</p>
                                        </div>
                                    </div>
                                    <div class="photo-example-card">
                                        <div class="photo-thumbnail" style="background-image: url('https://via.placeholder.com/150/cccccc/ffffff?text=Odomètre');"></div>
                                        <div class="photo-details">
                                            <h5>Odomètre</h5>
                                            <p>Lecture claire du kilométrage.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="upload-box">
                                <label for="photoInterieur" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos de l'intérieur ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoInterieur" class="photo-input" data-category="Interieur" data-max-files="10" multiple style="display: none;">
                                <div id="interieur-preview" class="image-preview-container"></div>
                            </div>
                        </div>

                        <div id="dommages" class="photo-tab-content">
                            <div class="photo-guide">
                                <h4><i class="fas fa-camera"></i> Photos des dommages </h4>
                                <p>Veuillez prendre des photos claires de tous les dommages ou imperfections notables.</p>
                            </div>
                            <div class="upload-box">
                                <label for="photoDommages" class="upload-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Cliquez ou glissez-déposez les photos des dommages ici</span>
                                    <small>Formats acceptés: JPG, PNG</small>
                                </label>
                                <input type="file" id="photoDommages" class="photo-input" data-category="Dommages" data-max-files="20" multiple style="display: none;">
                                <div id="dommages-preview" class="image-preview-container"></div>
                            </div>
                        </div>
                    </div>

                    <div class="full-width" style="margin-top: 40px;">
                        <button type="submit" class="btn btn-block">Obtenir mon évaluation gratuite</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const vinInput = document.getElementById('vin');
            const decodeVinBtn = document.getElementById('decodeVinBtn');
            const vinDecoderResults = document.getElementById('vin-decoder-results');

            // Fonction pour remplir les résultats du décodage (vous aurez besoin de votre API de décodage VIN ici)
            async function decodeVin(vin) {
                vinDecoderResults.style.display = 'block'; // Afficher la section des résultats

                // Réinitialiser les champs de décodage
                document.getElementById('decodedMarque').textContent = 'Décodage en cours...';
                document.getElementById('decodedModele').textContent = 'Décodage en cours...';
                document.getElementById('decodedAnnee').textContent = 'Décodage en cours...';
                document.getElementById('decodedCarburant').textContent = 'Décodage en cours...';
                document.getElementById('decodedTransmission').textContent = 'Décodage en cours...';


                try {
                    // REMPLACEZ CETTE PARTIE PAR VOTRE LOGIQUE D'APPEL API RÉELLE.
                    // C'est ici que vous interrogeriez un service de décodage VIN.
                    // Exemple avec une fausse attente pour simuler un appel réseau
                    // const response = await fetch(`VOTRE_API_DECODAGE_VIN_URL?vin=${vin}`);
                    // const data = await response.json();

                    // Données factices pour la démonstration (À SUPPRIMER POUR UNE VRAIE INTÉGRATION)
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Simule un délai réseau
                    const fakeData = {
                        Make: 'Honda',
                        Model: 'Civic',
                        ModelYear: '2023',
                        FuelTypePrimary: 'Essence',
                        TransmissionStyle: 'Automatique'
                    };

                    // Mettre à jour les éléments HTML avec les données décodées
                    document.getElementById('decodedMarque').textContent = fakeData.Make || 'N/A';
                    document.getElementById('decodedModele').textContent = fakeData.Model || 'N/A';
                    document.getElementById('decodedAnnee').textContent = fakeData.ModelYear || 'N/A';
                    document.getElementById('decodedCarburant').textContent = fakeData.FuelTypePrimary || 'N/A';
                    document.getElementById('decodedTransmission').textContent = fakeData.TransmissionStyle || 'N/A';

                    // Remplir les champs du formulaire avec les valeurs décodées si elles sont présentes
                    // Assurez-vous que les options existent dans vos <select>
                    if (fakeData.Make) {
                        const marqueSelect = document.getElementById('marque');
                        const optionExists = Array.from(marqueSelect.options).some(option => option.value === fakeData.Make);
                        if (optionExists) {
                            marqueSelect.value = fakeData.Make;
                        } else {
                            // Option non trouvée, l'ajouter ou gérer l'erreur
                            console.warn(`Marque "${fakeData.Make}" non trouvée dans la liste des options.`);
                        }
                    }
                    if (fakeData.Model) document.getElementById('modele').value = fakeData.Model;
                    if (fakeData.ModelYear) document.getElementById('annee').value = fakeData.ModelYear; // Année sera auto-remplie si l'option existe

                    if (fakeData.FuelTypePrimary) {
                        const carburantSelect = document.getElementById('carburant');
                        const optionExists = Array.from(carburantSelect.options).some(option => option.value === fakeData.FuelTypePrimary);
                        if (optionExists) {
                            carburantSelect.value = fakeData.FuelTypePrimary;
                        } else {
                            console.warn(`Carburant "${fakeData.FuelTypePrimary}" non trouvé dans la liste des options.`);
                        }
                    }
                    if (fakeData.TransmissionStyle) {
                        const transmissionSelect = document.getElementById('transmission');
                        const optionExists = Array.from(transmissionSelect.options).some(option => option.value === fakeData.TransmissionStyle);
                        if (optionExists) {
                            transmissionSelect.value = fakeData.TransmissionStyle;
                        } else {
                            console.warn(`Transmission "${fakeData.TransmissionStyle}" non trouvée dans la liste des options.`);
                        }
                    }

                } catch (error) {
                    console.error('Erreur lors du décodage VIN:', error);
                    // Gérer les erreurs de décodage
                    document.getElementById('decodedMarque').textContent = 'Erreur lors du décodage';
                    document.getElementById('decodedModele').textContent = 'Erreur lors du décodage';
                    document.getElementById('decodedAnnee').textContent = 'Erreur lors du décodage';
                    document.getElementById('decodedCarburant').textContent = 'Erreur lors du décodage';
                    document.getElementById('decodedTransmission').textContent = 'Erreur lors du décodage';
                    vinDecoderResults.style.display = 'block'; // Assurez-vous que le bloc reste visible pour l'erreur
                }
            }

            // --- Logique pour gérer le VIN scanné depuis l'URL ---
            const urlParams = new URLSearchParams(window.location.search);
            const scannedVin = urlParams.get('vinScanned');

            if (scannedVin) {
                vinInput.value = scannedVin; // Remplir le champ VIN
                // Optionnel: Supprimer le paramètre 'vinScanned' de l'URL pour une URL plus propre
                urlParams.delete('vinScanned');
                const newUrl = window.location.origin + window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
                window.history.replaceState({}, document.title, newUrl);

                // Déclencher le décodage du VIN automatiquement
                decodeVin(scannedVin);
            }

            // Initialisation de la liste des années
            const currentYear = new Date().getFullYear();
            const yearSelect = document.getElementById('annee');
            for (let i = currentYear + 1; i >= 1981; i--) { // +1 pour inclure l'année prochaine si nécessaire
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }

            // Écouteur d'événement pour le bouton "Décoder le VIN"
            decodeVinBtn.addEventListener('click', function() {
                const vin = vinInput.value.trim().toUpperCase();
                // Assurez-vous que le VIN a 17 caractères et ne contient pas les lettres interdites
                if (vin.length === 17 && /^[A-HJ-NPR-Z0-9]{17}$/.test(vin)) {
                    decodeVin(vin);
                } else {
                    alert("Veuillez entrer un VIN valide de 17 caractères (sans I, O, Q).");
                    vinDecoderResults.style.display = 'none'; // Cacher les résultats si VIN invalide
                }
            });

            // --- Gestion des onglets Photo ---
            const photoTabs = document.querySelectorAll('.photo-tab');
            const photoContents = document.querySelectorAll('.photo-tab-content');

            photoTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    photoTabs.forEach(t => t.classList.remove('active'));
                    photoContents.forEach(c => c.classList.remove('active'));

                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                });
            });

            // --- Gestion des téléchargements d'images ---
            document.querySelectorAll('.photo-input').forEach(input => {
                input.addEventListener('change', function(event) {
                    const previewContainerId = this.id.replace('photo', '').toLowerCase() + '-preview';
                    const previewContainer = document.getElementById(previewContainerId);
                    const maxFiles = parseInt(this.dataset.maxFiles || '5'); // Default max 5 if not specified

                    Array.from(event.target.files).forEach(file => {
                        // Check file count before adding
                        if (previewContainer.children.length >= maxFiles) {
                            alert(`Vous ne pouvez pas télécharger plus de ${maxFiles} images pour cette catégorie.`);
                            return;
                        }

                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const imgItem = document.createElement('div');
                                imgItem.classList.add('image-preview-item');

                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.alt = file.name;

                                const deleteBtn = document.createElement('button');
                                deleteBtn.classList.add('delete-image-btn');
                                deleteBtn.innerHTML = '&times;';
                                deleteBtn.title = 'Supprimer l\'image';
                                deleteBtn.onclick = function() {
                                    imgItem.remove();
                                };

                                imgItem.appendChild(img);
                                imgItem.appendChild(deleteBtn);
                                previewContainer.appendChild(imgItem);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    this.value = ''; // Clear the input so same file can be selected again
                });
            });

            // Handle drag and drop
            document.querySelectorAll('.upload-label').forEach(label => {
                label.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    label.style.borderColor = 'var(--secondary)';
                });

                label.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    label.style.borderColor = '#ccc';
                });

                label.addEventListener('drop', (e) => {
                    e.preventDefault();
                    label.style.borderColor = '#ccc';
                    const inputId = label.getAttribute('for');
                    const fileInput = document.getElementById(inputId);
                    fileInput.files = e.dataTransfer.files; // Assign dropped files to the input
                    const changeEvent = new Event('change', { bubbles: true });
                    fileInput.dispatchEvent(changeEvent); // Manually trigger change event
                });
            });

            // --- Form submission handler (example - you'll connect this to your backend) ---
            const evaluationForm = document.getElementById('evaluationForm');
            evaluationForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent default form submission

                alert('Formulaire soumis ! (Ceci est un exemple, vous devez implémenter la logique d\'envoi au serveur)');

                // Ici, vous collecteriez toutes les données du formulaire
                // et les enverriez à votre serveur (par exemple, via fetch API)
                const formData = new FormData(evaluationForm);
                const data = Object.fromEntries(formData.entries());

                // Pour les radios, assurez-vous de récupérer la valeur sélectionnée
                const selectedEtat = document.querySelector('input[name="etat"]:checked');
                if (selectedEtat) {
                    data.etat = selectedEtat.value;
                }

                // Ajoutez les photos (nécessitera un traitement plus complexe côté serveur)
                // Pour l'exemple, nous ne les envoyons pas directement comme objets File
                // car cela nécessite un multipart/form-data ou une conversion en Base64
                // data.photosExterieur = Array.from(document.getElementById('photoExterieur').files);
                // data.photosInterieur = Array.from(document.getElementById('photoInterieur').files);
                // data.photosDommages = Array.from(document.getElementById('photoDommages').files);

                console.log('Données du formulaire à envoyer:', data);

                // Exemple d'envoi avec Fetch (décommenter et adapter)
                /*
                fetch('/api/submit-evaluation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    console.log('Succès:', result);
                    // Gérer la redirection ou le message de succès
                })
                .catch(error => {
                    console.error('Erreur lors de la soumission:', error);
                    // Gérer l'erreur
                });
                */
            });

        });
    </script>
</body>
</html>
